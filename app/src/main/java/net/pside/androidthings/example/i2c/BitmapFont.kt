package net.pside.androidthings.example.i2c

import timber.log.Timber

object BitmapFont {

    val fonts = mapOf<Int, IntArray>(
            32 to intArrayOf(/*   */ 0x00, 0x00, 0x00, 0x00, 0x00),
            33 to intArrayOf(/* ! */ 0x00, 0x00, 0x5F, 0x00, 0x00),
            34 to intArrayOf(/* " */ 0x00, 0x07, 0x00, 0x07, 0x00),
            35 to intArrayOf(/* # */ 0x14, 0x7F, 0x14, 0x7F, 0x14),
            36 to intArrayOf(/* $ */ 0x24, 0x2A, 0x7F, 0x2A, 0x12),
            37 to intArrayOf(/* % */ 0x23, 0x13, 0x08, 0x64, 0x62),
            38 to intArrayOf(/* & */ 0x36, 0x49, 0x55, 0x22, 0x50),
            39 to intArrayOf(/* ' */ 0x00, 0x05, 0x03, 0x00, 0x00),
            40 to intArrayOf(/* ( */ 0x00, 0x1C, 0x22, 0x41, 0x00),
            41 to intArrayOf(/* ) */ 0x00, 0x41, 0x22, 0x1C, 0x00),
            42 to intArrayOf(/* * */ 0x08, 0x2A, 0x1C, 0x2A, 0x08),
            43 to intArrayOf(/* + */ 0x08, 0x08, 0x3E, 0x08, 0x08),
            44 to intArrayOf(/* , */ 0x00, 0x50, 0x30, 0x00, 0x00),
            45 to intArrayOf(/* - */ 0x08, 0x08, 0x08, 0x08, 0x08),
            46 to intArrayOf(/* . */ 0x00, 0x60, 0x60, 0x00, 0x00),
            47 to intArrayOf(/* / */ 0x20, 0x10, 0x08, 0x04, 0x02),
            48 to intArrayOf(/* 0 */ 0x3E, 0x51, 0x49, 0x45, 0x3E),
            49 to intArrayOf(/* 1 */ 0x42, 0x42, 0x7F, 0x40, 0x40),
            50 to intArrayOf(/* 2 */ 0x42, 0x61, 0x51, 0x49, 0x46),
            51 to intArrayOf(/* 3 */ 0x22, 0x41, 0x49, 0x49, 0x36),
            52 to intArrayOf(/* 4 */ 0x38, 0x24, 0x22, 0x7F, 0x20),
            53 to intArrayOf(/* 5 */ 0x2F, 0x45, 0x45, 0x45, 0x39),
            54 to intArrayOf(/* 6 */ 0x3C, 0x4A, 0x49, 0x49, 0x30),
            55 to intArrayOf(/* 7 */ 0x03, 0x01, 0x79, 0x05, 0x03),
            56 to intArrayOf(/* 8 */ 0x36, 0x49, 0x49, 0x49, 0x36),
            57 to intArrayOf(/* 9 */ 0x06, 0x49, 0x49, 0x49, 0x3E),
            58 to intArrayOf(/* : */ 0x00, 0x36, 0x36, 0x00, 0x00),
            59 to intArrayOf(/* ; */ 0x00, 0x56, 0x36, 0x00, 0x00),
            60 to intArrayOf(/* < */ 0x00, 0x08, 0x14, 0x22, 0x41),
            61 to intArrayOf(/* = */ 0x14, 0x14, 0x14, 0x14, 0x14),
            62 to intArrayOf(/* > */ 0x41, 0x22, 0x14, 0x08, 0x00),
            63 to intArrayOf(/* ? */ 0x02, 0x01, 0x51, 0x09, 0x06),
            64 to intArrayOf(/* @ */ 0x32, 0x49, 0x79, 0x41, 0x3E),
            65 to intArrayOf(/* A */ 0x7C, 0x12, 0x11, 0x12, 0x7C),
            66 to intArrayOf(/* B */ 0x7F, 0x49, 0x49, 0x49, 0x36),
            67 to intArrayOf(/* C */ 0x3E, 0x41, 0x41, 0x41, 0x22),
            68 to intArrayOf(/* D */ 0x7F, 0x41, 0x41, 0x22, 0x1C),
            69 to intArrayOf(/* E */ 0x7F, 0x49, 0x49, 0x49, 0x41),
            70 to intArrayOf(/* F */ 0x7F, 0x09, 0x09, 0x09, 0x01),
            71 to intArrayOf(/* G */ 0x3E, 0x41, 0x49, 0x49, 0x79),
            72 to intArrayOf(/* H */ 0x7F, 0x08, 0x08, 0x08, 0x7F),
            73 to intArrayOf(/* I */ 0x00, 0x41, 0x7F, 0x41, 0x00),
            74 to intArrayOf(/* J */ 0x20, 0x40, 0x41, 0x3F, 0x01),
            75 to intArrayOf(/* K */ 0x7F, 0x08, 0x14, 0x22, 0x41),
            76 to intArrayOf(/* L */ 0x7F, 0x40, 0x40, 0x40, 0x40),
            77 to intArrayOf(/* M */ 0x7F, 0x02, 0x04, 0x02, 0x7F),
            78 to intArrayOf(/* N */ 0x7F, 0x02, 0x04, 0x08, 0x7F),
            79 to intArrayOf(/* O */ 0x3E, 0x41, 0x41, 0x41, 0x3E),
            80 to intArrayOf(/* P */ 0x7F, 0x09, 0x09, 0x09, 0x06),
            81 to intArrayOf(/* Q */ 0x3E, 0x41, 0x51, 0x21, 0x5E),
            82 to intArrayOf(/* R */ 0x7F, 0x09, 0x19, 0x29, 0x46),
            83 to intArrayOf(/* S */ 0x26, 0x49, 0x49, 0x49, 0x32),
            84 to intArrayOf(/* T */ 0x01, 0x01, 0x7F, 0x01, 0x01),
            85 to intArrayOf(/* U */ 0x3F, 0x40, 0x40, 0x40, 0x3F),
            86 to intArrayOf(/* V */ 0x07, 0x18, 0x60, 0x18, 0x07),
            87 to intArrayOf(/* W */ 0x7F, 0x20, 0x10, 0x20, 0x7F),
            88 to intArrayOf(/* X */ 0x63, 0x14, 0x08, 0x14, 0x63),
            89 to intArrayOf(/* Y */ 0x03, 0x04, 0x78, 0x04, 0x03),
            90 to intArrayOf(/* Z */ 0x61, 0x51, 0x49, 0x45, 0x43),
            91 to intArrayOf(/* [ */ 0x00, 0x7F, 0x41, 0x41, 0x00),
            92 to intArrayOf(/* \ */ 0x02, 0x04, 0x08, 0x10, 0x20),
            93 to intArrayOf(/* ] */ 0x00, 0x41, 0x41, 0x7F, 0x00),
            94 to intArrayOf(/* ^ */ 0x04, 0x02, 0x01, 0x02, 0x04),
            95 to intArrayOf(/* _ */ 0x40, 0x40, 0x40, 0x40, 0x40),
            96 to intArrayOf(/* ` */ 0x00, 0x01, 0x02, 0x00, 0x00),
            97 to intArrayOf(/* a */ 0x24, 0x54, 0x54, 0x54, 0x78),
            98 to intArrayOf(/* b */ 0x7F, 0x44, 0x44, 0x44, 0x38),
            99 to intArrayOf(/* c */ 0x38, 0x44, 0x44, 0x44, 0x44),
            100 to intArrayOf(/* d */ 0x38, 0x44, 0x44, 0x44, 0x7F),
            101 to intArrayOf(/* e */ 0x38, 0x54, 0x54, 0x54, 0x18),
            102 to intArrayOf(/* f */ 0x08, 0x08, 0x7E, 0x09, 0x09),
            103 to intArrayOf(/* g */ 0x0C, 0x52, 0x52, 0x52, 0x3E),
            104 to intArrayOf(/* h */ 0x7F, 0x08, 0x04, 0x04, 0x78),
            105 to intArrayOf(/* i */ 0x00, 0x44, 0x7D, 0x40, 0x00),
            106 to intArrayOf(/* j */ 0x20, 0x40, 0x40, 0x44, 0x3D),
            107 to intArrayOf(/* k */ 0x7F, 0x20, 0x10, 0x28, 0x44),
            108 to intArrayOf(/* l */ 0x00, 0x41, 0x7F, 0x40, 0x00),
            109 to intArrayOf(/* m */ 0x7C, 0x04, 0x7C, 0x04, 0x78),
            110 to intArrayOf(/* n */ 0x7C, 0x04, 0x04, 0x04, 0x78),
            111 to intArrayOf(/* o */ 0x38, 0x44, 0x44, 0x44, 0x38),
            112 to intArrayOf(/* p */ 0x7E, 0x12, 0x12, 0x12, 0x0C),
            113 to intArrayOf(/* q */ 0x0C, 0x12, 0x12, 0x12, 0x7E),
            114 to intArrayOf(/* r */ 0x7C, 0x08, 0x04, 0x04, 0x08),
            115 to intArrayOf(/* s */ 0x48, 0x54, 0x54, 0x54, 0x24),
            116 to intArrayOf(/* t */ 0x04, 0x04, 0x3F, 0x44, 0x44),
            117 to intArrayOf(/* u */ 0x3C, 0x40, 0x40, 0x40, 0x7C),
            118 to intArrayOf(/* v */ 0x1C, 0x20, 0x40, 0x20, 0x1C),
            119 to intArrayOf(/* w */ 0x3C, 0x40, 0x38, 0x40, 0x3C),
            120 to intArrayOf(/* x */ 0x44, 0x28, 0x10, 0x28, 0x44),
            121 to intArrayOf(/* y */ 0x0E, 0x50, 0x50, 0x50, 0x3E),
            122 to intArrayOf(/* z */ 0x44, 0x64, 0x54, 0x4C, 0x44),
            123 to intArrayOf(/* { */ 0x00, 0x08, 0x36, 0x41, 0x41),
            124 to intArrayOf(/* | */ 0x00, 0x00, 0x77, 0x00, 0x00),
            125 to intArrayOf(/* } */ 0x41, 0x41, 0x36, 0x08, 0x00),
            126 to intArrayOf(/* ~ */ 0x08, 0x04, 0x08, 0x10, 0x08)
    )

    fun getCharMap(char: Char): IntArray {
        return getCharMap(char.toInt())
    }

    fun getCharMap(charCode: Int): IntArray {
        val value = intArrayOf(0, 0, 0, 0, 0, 0, 0)
        val font = fonts.get(charCode)
        if (font == null) {
            Timber.w("Missing character: %d", charCode)
            return intArrayOf(
                    0b00000,
                    0b10001,
                    0b01010,
                    0b00100,
                    0b01010,
                    0b10001,
                    0b00000
            )
        }

        for (x in 0..MicroDotLED.WIDTH - 1) {
            for (y in 0..MicroDotLED.HEIGHT - 1) {
                val b = font[x].and(1.shl(MicroDotLED.HEIGHT - 1 - y))

                val newY = MicroDotLED.HEIGHT - 1 - y
                val newB = 1.shl(MicroDotLED.WIDTH - 1 - x)
                value[newY] = if (b > 0) {
                    value[newY].or(newB)
                } else {
                    value[newY].and(newB.inv())
                }
            }
        }

        return value
    }

}